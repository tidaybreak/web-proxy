status_code: 200
Server: openresty
Date: Wed, 01 Sep 2021 01:43:02 GMT
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
Vary: Cookie
Content-Encoding: gzip



<!DOCTYPE html>


<html lang="zh-hans" >
<head>
    <title> 域名URL排行页 | CDNPlus</title>

    

    <link rel="stylesheet" type="text/css" href="/static/admin/simpleui-x/elementui/theme-chalk/index.css">
    <link rel="stylesheet" type="text/css" href="/static/admin/simpleui-x/fontawesome-free-5.8.1-web/css/all.min.css">


    <link rel="stylesheet" type="text/css" href="/static/admin/css/base.css?_=2.7">
    <link rel="stylesheet" type="text/css" href="/static/admin/simpleui-x/css/base.css?_=2.7">
    <link rel="stylesheet" type="text/css" href="/static/admin/simpleui-x/theme/simpleui.css">



    

    <script type="text/javascript" src="/static/admin/simpleui-x/js/vue.min.js?_=2020.9.26"></script>
    <script type="text/javascript" src="/static/admin/simpleui-x/elementui/index.js?_=2020.9.26"></script>
	<script src="/static/ramda.min.js"></script>



    <script type="text/javascript" src="/static/admin/simpleui-x/js/language.js?_=2.1.2"></script>
    <script type="text/javascript" src="/static/admin/simpleui-x/locale/en-us.js?_=2.1.2"></script>
    <script type="text/javascript" src="/static/admin/simpleui-x/locale/zh-hans.js"></script>

    
    <script type="text/javascript" src="/static/admin/simpleui-x/js/cookie.js"></script>
    
    
    <!-- aditional stylesheets -->
    <link rel="stylesheet" href="/static/user/bootstrap/css/bootstrap.min.css">
    <!-- todc-bootstrap -->
    <link rel="stylesheet" href="/static/user/css/todc-bootstrap.min.css">

    <link rel="stylesheet" href="/static/user/css/font-awesome/css/font-awesome.min.css">
    <!-- flag icon set -->
    <link rel="stylesheet" href="/static/user/img/flags/flags.css">
    <!-- linecons -->
    <link rel="stylesheet" href="/static/user/css/linecons/style.css">
    <!-- ebro styles -->
    <link rel="stylesheet" href="/static/user/css/style_custom.css">
    <!-- jqueryUI theme -->
    <link rel="stylesheet" href="/static/admin/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/static/user/js/lib/jquery_ui/css/delta/jquery-ui.css">
    <!-- jquery datetimepicker -->
    <link rel="stylesheet" href="/static/user/js/lib/jquery.datetimepicker/jquery.datetimepicker.min.css">
    <!-- 2col multiselect -->
    <link rel="stylesheet" href="/static/user/js/lib/jquery-ui-MultiSelect/jquery.multiselect.css">
    <link rel="stylesheet" href="/static/user/js/lib/jquery-ui-MultiSelect/jquery.multiselect.filter.css">
    <style>
        .no-padding{
            padding-right:0px;
        }
        .ui-multiselect-checkboxes {
            overflow: auto !important;
        }
        button.ui-multiselect{
            border-radius: 2px;
        }
        .ui-multiselect-filter input{
            border-radius:2px;
        }
        .ui-multiselect-filter input{
            width: 120px;
        }
        body {
            line-height: 1.5 !important;
        }
        #content-main {
            min-width: 400px;
        }

    </style>

    
    
    
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/admin/css/responsive.css?_=20180905"/>
    
    
    
    <meta name="robots" content="NONE,NOARCHIVE"/>
    
    <script type="text/javascript" src="/static/admin/js/vendor/jquery/jquery.min.js"></script>
</head>


<body class=""
      data-admin-utc-offset=" 28800">




<div id="theme">
    <link v-if="theme && theme!=''" rel="stylesheet" :href="theme">

    
</div>
<script type="text/javascript">

    var fontConfig = new Vue({
        data: {
            fontSize: null
        },
        watch: {
            fontSize: function (newValue) {
                if (newValue != 0) {
                    var fontStyle = document.getElementById('fontStyle');
                    if (!fontStyle) {
                        fontStyle = document.createElement('style');
                        fontStyle.id = 'fontStyle';
                        fontStyle.type = 'text/css';
                        document.head.append(fontStyle);
                    }
                    fontStyle.innerHTML = '*{font-size:' + newValue + 'px!important;}'

                } else {
                    var fontStyle = document.getElementById('fontStyle');
                    if (fontStyle) {
                        fontStyle.remove();
                    }
                }
            }
        },
        created: function () {
            var val = getCookie('fontSize');
            if (val) {
                this.fontSize = parseInt(val);
            } else {
                this.fontSize = 0;
            }
        },
        methods: {}
    });


    new Vue({
        el: '#theme',
        data: {
            theme: '',
        },
        created: function () {
            this.theme = getCookie('theme');

            var self = this;
            //向父组件注册事件
            if (parent.addEvent) {
                parent.addEvent('theme', function (theme) {
                    self.theme = theme;
                });

                parent.addEvent('font', function (font) {
                    fontConfig.fontSize = font;
                });
                // 注释掉它，避免菜单出现问题



            }

        }
    })
    window.addEventListener('beforeunload', () => {
        if (window.beforeLoad) {
            window.beforeLoad();
        }
    });

</script>
<!-- Container -->
<div id="container">

    
    
    <script id="out_message" type="text/javascript">var messages=[]</script>
    
    <script type="text/javascript">

        new Vue({
            created: function () {
                var self = this;

                messages.forEach(item => {
                    setTimeout(function () {
                        self.$notify({
                            title: getLanuage('Tips'),
                            message: item.msg,
                            type: item.tag,
                            dangerouslyUseHTMLString: true
                        });
                    }, 200);
                });

            }
        })
    </script>

    

    <div class="menu-content">
        
    </div>
    <!-- Content -->
    <div id="content" class="colM">
        
        

        
        
        
        
        
    
    <div id="content-main">
        <!-- main content -->
        <div class="row">
            <div class="col-md-3 col-sm-6 clearfix" style="display:none">
                <select id="select_node" class="form-control" multiple="multiple">
                        
                        <option value="d26860dfb10103252fc05ed0c8d0a94b" selected>localhost.localdomain</option>
                        
                </select>
            </div>
            <div class="col-md-3 col-sm-6 clearfix" style="display:none">
                <select id="select_domain" class="form-control" multiple="multiple">
                        
                        <option value="abb.com" selected>abb.com</option>
                        
                        <option value="cdnplus.cn" selected>cdnplus.cn</option>
                        
                        <option value="console.cdnplus.cn" selected>console.cdnplus.cn</option>
                        
                        <option value="www.tencent.com" selected>www.tencent.com</option>
                        
                        <option value="111.com" selected>111.com</option>
                        
                        <option value="aaa.bb.com" selected>aaa.bb.com</option>
                        
                        <option value="aaa.ddd.com" selected>aaa.ddd.com</option>
                        
                        <option value="bbb.ccc.com" selected>bbb.ccc.com</option>
                        
                        <option value="aaaa" selected>aaaa</option>
                        
                        <option value="1111.com" selected>1111.com</option>
                        
                        <option value="www.1111.com" selected>www.1111.com</option>
                        
                </select>
            </div>
            <!--<div class="col-md-5 col-sm-10">
                <div class="row">
                    <div class="col-sm-7 btn-group no-padding">
                        <button type="button" class="btn btn-default btn-success" onclick="setCacheHit(this, null)">全部</button>
                        <button type="button" class="btn btn-default" onclick="setCacheHit(this, 1)">命中</button>
                        <button type="button" class="btn btn-default" onclick="setCacheHit(this, 0)">未命中</button>
                    </div>
                </div>
            </div>
            <div class="col-md-1 col-sm-2">
                <button type="button" class="btn btn-success" onclick="btnSearch()">查询</button>
            </div>-->
        </div>
        <div class="row" id="search_type">
            <div class="col-md-9 col-sm-12">
                <div class="col-sm-2">
                    <button type="button" class="btn btn-md btn-default" onclick="bandwith_init(this)">流量</button>
                </div>
                <div class="col-md-offset-1 col-sm-2">
                    <button type="button" class="btn btn-md btn-default" onclick="flow_init(this)">峰值带宽</button>
                </div>
                <div class="col-md-offset-1 col-sm-2">
                    <button type="button" class="btn btn-md btn-default" onclick="visit_init(this)">请求数量</button>
                </div>
            </div>
        </div>
        <!--<div class="row" style="margin-bottom: 40px;">
            <div class="col-sm-12">
                <div class="panel panel-default">
                    <div id="status_code_line" class="chart_b" style="height: 400px;">
                </div>
                </div>
            </div>

        </div>
		
        <div class="row">
            <div class="col-sm-12">
                <div class="panel panel-default">
                    <div id="chart_ranking" class="chart_a" style="height: 400px;"></div>
                </div>
            </div>
        </div>-->
        <div class="row">
            <div class="col-sm-12">
                <div class="panel panel-default">
                    <div id="chart_map" class="chart_a" style="height: 400px;"></div>
                </div>
            </div>
        </div>		
		<div class="row">
            <div class="col-sm-12">
                <div class="panel panel-default">
                    <div id="chart_idc" class="chart_a" style="height: 400px;"></div>
                </div>
            </div>
        </div>	
    </div>

    
    
        <!-- jQuery -->
        <script src="/static/user/js/jquery.min.js"></script>
        <!-- bootstrap framework -->
        <script src="/static/user/bootstrap/js/bootstrap.min.js"></script>
        <script src="/static/user/js/lib/select2/select2.min.js"></script>
        <script src="/static/user/js/lib/jquery.datetimepicker/jquery.datetimepicker.full.min.js"></script>
        <script src="/static/user/js/lib/jquery-ui-1.11.4.custom/jquery-ui.js"></script>
        <link rel="stylesheet" href="/static/user/js/lib/jquery-ui-1.11.4.custom/jquery-ui.css"/>
        <!--query multiselect -->
        <script src="/static/user/js/lib/jquery-ui-MultiSelect/jquery.multiselect.min.js"></script>
        <script src="/static/user/js/lib/jquery-ui-MultiSelect/jquery.multiselect.filter.js"></script>
        <!-- jQuery resize event -->
        <script src="/static/user/js/jquery.ba-resize.min.js"></script>
        <!-- retina ready -->
        <link rel="stylesheet" href="/static/user/css/retina.css">
        <!-- retina ready -->
        <script src="/static/user/js/retina.min.js"></script>

        <script src="/static/user/js/lib/echarts/echarts.min.js"></script>
		<script src="/static/echarts-china-map-master/js/map/china.js"></script>
        <script src="/static/user/js/lib/echarts/shine.js"></script>
        <!--<script src="/static/user/js/lib/echarts/macarons.js"></script>-->
    

    <script>

	$(function() {
      Date.prototype.format = function (fmt) {
        var o = {
          "M+": this.getMonth() + 1, //月份
          "d+": this.getDate(), //日
          "h+": this.getHours(), //小时
          "m+": this.getMinutes(), //分
          "s+": this.getSeconds(), //秒
          "q+": Math.floor((this.getMonth() + 3) / 3), //季度
          "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt))
          fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o){
          if (new RegExp("(" + k + ")").test(fmt)) {
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
          }
        }
        return fmt;
      }
	  //查询参数
      function DateTime(date){ //返回合法的时间
        var a = new Date(date);
        return a.format('yyyyMMddhhmm');
      }
      var params = {
        'start_time': 202109010843,
        'end_time': 202109010943,
        'node': $('#select_node').val(),
        'domain': $('#select_domain').val()
      };
	  //初始化页面中的插件
      $('#select_node').multiselect({
        checkAllText: '选中全部',
        uncheckAllText: '取消全选',
        noneSelectedText: '请选择节点',
        selectedText: '# 个节点选中',
        selectedList: 1,
        show: null,
        hide: null,
        autoOpen: false,
        multiple: true,
        menuHeight: '200px',
        resizableMenu: true
      }).multiselectfilter({placeholder: '输入名称', width: '120px', label: '搜索'});
      $('#select_domain').multiselect({
        checkAllText: '选中全部',
        uncheckAllText: '取消全选',
        noneSelectedText: '请选择域名',
        selectedText: '# 个域名选中',
        selectedList: 1,
        show: null,
        hide: null,
        autoOpen: false,
        multiple: true,
        menuHeight: '200px',
        resizableMenu: true
      }).multiselectfilter({placeholder: '输入名称', width: '120px', label: '搜索'});
      // 绑定事件
      $('#select_domain').on('change', function(e){
        params.domain = $(this).val();
      })
      $('#select_node').on('change', function(e){
        params.node = $(this).val();
      })
      if( ($('#dpStart').length) && ($('#dpEnd').length) ) {
        $.datetimepicker.setLocale('ch');
        var datetime_options = {
          format: 'Y-m-d H:i',
          step: 1,
          defaultTime: false,
          defaultDate: false,
          todayButton: true,
          showApplyButton: false,

        }
        $('#dpStart').datetimepicker(datetime_options).on('change', function(e){
          params.start_time = DateTime($('#dpStart').val());
        });
        $('#dpEnd').datetimepicker(datetime_options).on('change', function(e){
          params.end_time = DateTime($('#dpStart').val());
        });
      }
      var timeText = '1小时';
      var colorList = ['rgb(15,111,198)', 'rgb(0,157,217)', 'rgb(11,208,207)', 'rgb(16,207,155)',
                    'rgb(124,202,98)', 'rgb(244,145,0)'];
	  
	  map_option = {
					title: [{
						text: '访问区域-',
						subtext: '',
						left: 'center',
						top: '1%'
                    }],
					tooltip: {
							formatter:function(params,ticket, callback){
								return params.seriesName+'<br />'+params.name+'：'+params.value
							}//数据格式化
						},
					visualMap: {//颜色的设置  dataRange
						x: 'left',
						y: 'center',
						splitList: [
							{ start: 900, color: '#2D71D6' },
							{ start: 500, end: 900, color: '#3375e4' },
							{ start: 300, end: 500, color: '#6797ef' },
							{ start: 200, end: 300, color: '#96b5ef' },
							{ start: 50, end: 200, color: '#B8E0F5' },
							{ start: 0, end: 50, color: '#E1FBFD' },
						],
					},
					geo: {
						map: 'china',
						roam: true,//不开启缩放和平移
						zoom:1.23,//视角缩放比例
						label: {
							normal: {
								show: true,
								fontSize:'10',
								color: 'rgba(0,0,0,0.7)'
							}
						},
						itemStyle: {
							normal:{
								borderColor: 'rgba(0, 0, 0, 0.2)'
							},
							emphasis:{
								areaColor: '#F3B329',//鼠标选择区域颜色
								shadowOffsetX: 0,
								shadowOffsetY: 0,
								shadowBlur: 20,
								borderWidth: 0,
								shadowColor: 'rgba(0, 0, 0, 0.5)'
							}
						}
					},
					series : [
						{
							name: '信息量',
							type: 'map',
							geoIndex: 0,
							data:[],
							layoutCenter: ['70%', '50%'],
							layoutSize: 450
						}
					]
	  };
  
	function randomValue() {
		return Math.round(Math.random()*1000);
	}
	function randomNum(minNum,maxNum){ 
		switch(arguments.length){ 
			case 1: 
				return parseInt(Math.random()*minNum+1,10); 
			break; 
			case 2: 
				return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10); 
			break; 
				default: 
					return 0; 
				break; 
		} 
	}			

	  function map_data(vmin, vmax) {

		var dataList=[]
		province = ['广东', '江苏', '山东', '浙江', '河南', '四川', '福建', '湖北', '湖南', '上海', '安徽', '河北', '北京', '陕西', '江西', '辽宁', '重庆', '云南', '广西', '贵州', '山西', '内蒙古', '天津', '新疆', '黑龙江', '吉林', '甘肃', '海南', '宁夏', '青海', '西藏', '南海诸岛']
		
		var last_rand = randomNum(vmin, vmax)
		for (var i=0;i<province.length;i++)
		{
			dataList.push({name: province[i], value: last_rand});
			last_rand = Math.floor(last_rand * randomNum(80, 100) / 100)
		}
		return dataList;
	  }
			
	overview = {
        map_info: function(name, unit, vmin, vmax){
			var bar = echarts.init(document.getElementById('chart_map'));
			bar.showLoading({'effect': 'bubble'});
			params.type = 'visit';
			$.getJSON('/statistic/query-domain-ranking/', params).done(function(res){
				bar.hideLoading();
				var x_values = [];
				var y_values = [];
				res.data.map(function(value, index){
				  x_values.push(value[1]);
				  y_values.push(value[0])
				})
				map_option['title'][0]['text'] += name
				map_option['series'][0]['data'] = map_data(vmin, vmax)
				map_option['series'][0]['name'] = unit;
				bar.setOption(map_option);
			})

        }
      };
	  //按钮点击事件
      bandwith_init = function(e){
        overview.map_info('流量', '流量(GB)', 800, 999);
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
      }
      flow_init = function(e){
		overview.map_info('峰值带宽', '速率(Mbit/s)', 800, 999);
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
      }
      visit_init = function(e){
		overview.map_info('请求数量', '万次', 800, 999);
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
      }
      //触发默认数据
      $('#search_type button').eq(0).click();
      //搜索按钮
      btnSearch = function(){
        $('#search_type button.btn-success').click();
      }
      //赋值时间
      setTime = function(e, start, end){
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
        //自定义去掉样式
        $('#customTime').removeClass('btn-success');
        params.start_time = start;
        params.end_time = end;
        btnSearch();
        timeText = $(e).text()
        $('.summaryTime').text(timeText);
      }
      setCustomTime = function(){
        var start_str = $('#dpStart').val();
        var end_str = $('#dpEnd').val();
        var start = DateTime(start_str);
        var end = DateTime(end_str);
        params.start_time = start;
        params.end_time = end;
        var c = '从'+start_str+'至'+end_str;
        var e = $('#customTime');
        e.html('<small title="'+c+'">'+c+'</samll>');
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
        btnSearch();
        timeText = '自定义';
        $('.summaryTime').text(timeText);
      }
      // 设置过滤条件
      setCacheHit = function(e, hit){
        $(e).parent().parent().find('button').removeClass('btn-success');
        $(e).addClass('btn-success');
        params.hit = hit;
        btnSearch();
        timeText = $(e).text()
      }
	  
	  
	var chartDom = document.getElementById('chart_idc');
	var myChart = echarts.init(chartDom);
	var option;

	var dataList=[]
	province = ['中国联通', '中国电信', '中国移动', '教育网', '长城宽带', '中国铁通', '其他']
	var last_rand = randomNum(800, 999)
	for (var i=0;i<province.length;i++)
	{
		dataList.push({name: province[i], value: last_rand, rate: last_rand});
		if (i === 2) {
			last_rand = Math.floor(last_rand * randomNum(10, 20) / 100)
		} else {
			last_rand = Math.floor(last_rand * randomNum(80, 100) / 100)
		}
	}
	option = {
		title: {
			text: '运营商统计',
			subtext: '',
			left: 'center'
		},
		tooltip: {
			show: true,
			formatter: "{a} <br/>{b} : {c} ({d}%)"
		},
		legend: {
		  orient: "horization", // 垂直排列
		  top: 40,
		  left: 40,
		  itemGap: 14, // 调整每项之前的间距
		  textStyle: {
			color: "#808080", // 文本颜色
		  },
		  formatter: function(name) {
			let rate = R.propOr(0, "rate", R.find(R.propEq("name", name))(dataList));
			//rate = (rate * 100).toFixed(1);
			// 显示名称+百分比
			return `${name} ${rate}GB`;
		  },
		},
		series: [
			{
				name: 'GB',
				type: 'pie',
				radius: '50%',
				label: {
					normal: {
						formatter: '{b}:{c}' + '\n\r' + '({d}%)',
						show: true,
						position: 'left'
					},
					emphasis: {
						show: true,
						textStyle: {
							fontSize: '30',
							fontWeight: 'bold'
						}
					}
				},				
				data: [
					{value: 1048, name: '搜索引擎'},
					{value: 735, name: '直接访问'},
					{value: 580, name: '邮件营销'},
					{value: 484, name: '联盟广告'},
					{value: 300, name: '视频广告'}
				],
				labelLine: {
					normal: {
						show: true
					}
				},
				emphasis: {
					itemStyle: {
						shadowBlur: 10,
						shadowOffsetX: 0,
						shadowColor: 'rgba(0, 0, 0, 0.5)'
					}
				}
			}
		]
	};

	option["series"][0]["data"] = dataList
		
	option && myChart.setOption(option);
    })
    </script>



        
        <br class="clear"/>
    </div>
    <!-- END Content -->

    
    <div id="footer"></div>
    
</div>
<!-- END Container -->
</body>
</html>